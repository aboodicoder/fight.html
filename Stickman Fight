<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stickman Duel ‚Äî Multi Arena</title>
<style>
body{margin:0;overflow:hidden;background:#000;font-family:sans-serif;}
canvas{display:block;}
#ui{position:absolute;top:10px;width:100%;display:flex;justify-content:space-between;padding:0 20px;color:white;font-weight:bold;}
.hp-bar{width:200px;height:20px;background:#444;border:2px solid #222;position:relative;}
.hp-fill{height:100%;background:#0f0;width:100%;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:20;}
.card{background:#111;padding:20px;border-radius:14px;color:#fff;text-align:center;}
button{margin:5px;padding:10px 16px;border:none;border-radius:10px;background:#333;color:#fff;cursor:pointer;}
button:hover{background:#555;}
</style>
</head>
<body>
<div id="ui">
<div>Player1 <div class="hp-bar"><div class="hp-fill" id="p1hp"></div></div></div>
<div>Player2 <div class="hp-bar"><div class="hp-fill" id="p2hp"></div></div></div>
</div>
<canvas id="c" width="1200" height="520"></canvas>

<div id="overlay" class="overlay">
  <div class="card">
    <h2>Choose Arena</h2>
    <button id="arenaGrasslands">üåø Grasslands</button>
    <button id="arenaSahara">üèúÔ∏è Sahara</button>
    <button id="arenaRainyForest">üåßÔ∏è Rainy Forest</button>
    <button id="arenaDryland">üèûÔ∏è Dryland</button>
    <div style="margin-top:10px;font-size:12px;">All by <strong>aboodicoder</strong></div>
  </div>
</div>

<script>
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
const cw=canvas.width,ch=canvas.height;
const groundY=ch-80;

// --- Player Class ---
class Player{
  constructor(x,color,facing){
    this.x=x;this.y=groundY;this.vx=0;this.vy=0;
    this.width=36;this.height=70;
    this.color=color;this.facing=facing;
    this.onGround=true;this.health=100;
    this.punch=false;this.punchTimer=0;
    this.kick=false;this.kickTimer=0;
    this.inPondTime=0;this.bubbles=[];
  }
  rect(){return {x:this.x-this.width/2,y:this.y-this.height,w:this.width,h:this.height};}
  punchBox(){return {x:this.x+this.facing*30-15,y:this.y-45,w:30,h:20};}
  kickBox(){return {x:this.x+this.facing*35-15,y:this.y-40,w:35,h:25};}
}
const p1=new Player(360,'#0ff',1);
const p2=new Player(840,'#f0f',-1);

// --- Input ---
const keys={};
window.addEventListener('keydown',e=>keys[e.code]=true);
window.addEventListener('keyup',e=>keys[e.code]=false);

// --- Arena Data ---
let currentArena='grasslands';
const pond={x:500,y:groundY,width:200,height:50};
let trees=[],clouds=[],desertBalls=[],rainDrops=[];
function setupArena(arena){
  trees=[];clouds=[];desertBalls=[];rainDrops=[];
  if(arena==='grasslands'){for(let i=0;i<5;i++){trees.push({x:100+Math.random()*1000});}
  for(let i=0;i<3;i++){clouds.push({x:50+Math.random()*1100,y:50+Math.random()*50});}}
  if(arena==='sahara'){for(let i=0;i<5;i++){desertBalls.push({x:Math.random()*1200,y:groundY-20});}}
  if(arena==='rainyforest'){for(let i=0;i<100;i++){rainDrops.push({x:Math.random()*cw,y:Math.random()*ch,vy:200+Math.random()*100});}}
}

// --- Sounds ---
function playTone(freq,dur){try{const ac=new (window.AudioContext||window.webkitAudioContext)(); const osc=ac.createOscillator(); const gain=ac.createGain(); osc.connect(gain); gain.connect(ac.destination); osc.frequency.value=freq; osc.start(); osc.stop(ac.currentTime+dur);}catch(e){}}
function punchSound(){playTone(600,0.08);}
function kickSound(){playTone(480,0.08);}
function hitSound(){playTone(180,0.1);}
function winSound(){playTone(880,0.2);}

// --- Physics ---
function applyPhysics(p,dt){
  const g=1400;
  p.vy+=g*dt; p.x+=p.vx*dt; p.y+=p.vy*dt;
  if(p.y>groundY){p.y=groundY;p.vy=0;p.onGround=true;}else p.onGround=false;
  p.vx*=0.88;
  // Dryland hill
  if(currentArena==='dryland'){let hillX=cw/2,hWidth=200,hHeight=50;
    if(p.x>hillX-hWidth/2 && p.x<hillX+hWidth/2){
      let hillTop=groundY-hHeight*Math.sin((p.x-(hillX-hWidth/2))/hWidth*Math.PI);
      if(p.y>hillTop)p.y=hillTop;
    }
  }
  // Pond sinking
  if(currentArena==='grasslands' && p.x>pond.x && p.x<pond.x+pond.width && p.y>groundY-10)p.y=groundY-10;
}

// --- Combat ---
function rectOverlap(a,b){return !(a.x+a.w<b.x || a.x>b.x+b.w || a.y+a.h<b.y || a.y>b.y+b.h);}
function doPunch(a,b){if(a.punch && a.punchTimer>0.05){if(rectOverlap(a.punchBox(),b.rect())){b.health=Math.max(0,b.health-10);b.vx=a.facing*200;b.vy=-140;hitSound();}}}
function doKick(a,b){if(a.kick && a.kickTimer>0.05){if(rectOverlap(a.kickBox(),b.rect())){b.health=Math.max(0,b.health-10);b.vx=a.facing*200;b.vy=-140;hitSound();}}}

// --- Update ---
function update(dt){
  // Input
  if(keys['KeyA']){p1.vx=-200;p1.facing=-1;}
  if(keys['KeyD']){p1.vx=200;p1.facing=1;}
  if(keys['KeyW'] && p1.onGround){p1.vy=-450;p1.onGround=false;}
  if(keys['KeyS'] && !p1.punch){p1.punch=true;p1.punchTimer=0;punchSound();}
  if(keys['ShiftLeft'] && !p1.kick){p1.kick=true;p1.kickTimer=0;kickSound();}

  if(keys['ArrowLeft']){p2.vx=-200;p2.facing=-1;}
  if(keys['ArrowRight']){p2.vx=200;p2.facing=1;}
  if(keys['ArrowUp'] && p2.onGround){p2.vy=-450;p2.onGround=false;}
  if(keys['ArrowDown'] && !p2.punch){p2.punch=true;p2.punchTimer=0;punchSound();}
  if(keys['ShiftRight'] && !p2.kick){p2.kick=true;p2.kickTimer=0;kickSound();}

  applyPhysics(p1,dt); applyPhysics(p2,dt);

  // Pond bubbles & damage
  [p1,p2].forEach(p=>{
    if(currentArena==='grasslands' && p.x>pond.x && p.x<pond.x+pond.width && p.y>groundY-10){
      p.inPondTime+=dt;
      if(p.bubbles.length<3 && Math.floor(p.inPondTime)>p.bubbles.length)p.bubbles.push({});
      if(p.inPondTime>3)p.health=Math.max(0,p.health-10*dt);
    } else {p.inPondTime=0;p.bubbles=[];}
  });

  // Punch/Kick
  doPunch(p1,p2); doPunch(p2,p1);
  doKick(p1,p2); doKick(p2,p1);

  // Timers
  if(p1.punch){p1.punchTimer+=dt;if(p1.punchTimer>0.25)p1.punch=false;}
  if(p1.kick){p1.kickTimer+=dt;if(p1.kickTimer>0.25)p1.kick=false;}
  if(p2.punch){p2.punchTimer+=dt;if(p2.punchTimer>0.25)p2.punch=false;}
  if(p2.kick){p2.kickTimer+=dt;if(p2.kickTimer>0.25)p2.kick=false;}

  // Update UI
  document.getElementById('p1hp').style.width=p1.health+'%';
  document.getElementById('p2hp').style.width=p2.health+'%';

  // Win check
  if(p1.health<=0 || p2.health<=0){winSound();running=false;}
}

// --- Draw ---
function draw(){
  ctx.clearRect(0,0,cw,ch);
  // Background
  if(currentArena==='grasslands'){ctx.fillStyle="#87ceeb";ctx.fillRect(0,0,cw,ch);}
  if(currentArena==='sahara'){ctx.fillStyle="#f9e79f";ctx.fillRect(0,0,cw,ch);}
  if(currentArena==='rainyforest'){ctx.fillStyle="#3a5f0b";ctx.fillRect(0,0,cw,ch);}
  if(currentArena==='dryland'){ctx.fillStyle="#d8c19f";ctx.fillRect(0,0,cw,ch);}

  // Clouds
  if(currentArena==='grasslands'){
    clouds.forEach(c=>{ctx.fillStyle="white";ctx.beginPath();ctx.arc(c.x,c.y,20,0,2*Math.PI);ctx.fill();c.x+=10/60;if(c.x>cw)c.x=-50;});
  }

  // Ground
  ctx.fillStyle=currentArena==='sahara'?'#f1c40f':currentArena==='rainyforest'?'#145a32':'#6aa84f';
  ctx.fillRect(0,groundY,cw,ch-groundY);

  // Pond
  if(currentArena==='grasslands'){ctx.fillStyle="#1e90ff";ctx.fillRect(pond.x,groundY-pond.height,pond.width,pond.height);}
  // Trees
  if(currentArena==='grasslands'){trees.forEach(t=>{ctx.fillStyle="#8b4513";ctx.fillRect(t.x,groundY-50,10,50);ctx.fillStyle="#228b22";ctx.beginPath();ctx.moveTo(t.x-15,groundY-50);ctx.lineTo(t.x+25,groundY-50);ctx.lineTo(t.x+5,groundY-90);ctx.closePath();ctx.fill();});}
  // Sahara balls
  if(currentArena==='sahara'){desertBalls.forEach(b=>{ctx.fillStyle="#deb887";ctx.beginPath();ctx.arc(b.x,b.y,20,0,Math.PI*2);ctx.fill();b.x+=60/60;if(b.x>cw)b.x=-20;});}
  // Rain
  if(currentArena==='rainyforest'){rainDrops.forEach(r=>{ctx.strokeStyle="#0cf";ctx.beginPath();ctx.moveTo(r.x,r.y);ctx.lineTo(r.x,r.y+5);ctx.stroke();r.y+=r.vy/60;if(r.y>ch)r.y=-10;});}
  // Dryland hill
  if(currentArena==='dryland'){ctx.fillStyle="#a67b5b";ctx.beginPath();const hillX=cw/2,hWidth=200,hHeight=50;for(let i=0;i<=hWidth;i++){let x=hillX-hWidth/2+i,y=groundY-hHeight*Math.sin(i/hWidth*Math.PI);if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);}ctx.lineTo(cw/2+hWidth/2,groundY);ctx.lineTo(cw/2-hWidth/2,groundY);ctx.fill();}

  // Players
  [p1,p2].forEach(p=>{
    ctx.strokeStyle=p.color;ctx.lineWidth=3;
    let headY=p.y-p.height+14;
    ctx.beginPath();ctx.arc(p.x,headY,12,0,2*Math.PI);ctx.stroke();
    ctx.beginPath();ctx.moveTo(p.x,headY+14);ctx.lineTo(p.x,p.y-18);ctx.stroke();
    let legSwing=Math.sin(Date.now()/200)*5;
    ctx.beginPath();ctx.moveTo(p.x,p.y-18);ctx.lineTo(p.x-14,p.y+legSwing);ctx.moveTo(p.x,p.y-18);ctx.lineTo(p.x+18,p.y-legSwing);ctx.stroke();
    let armSwing=Math.sin(Date.now()/200)*10;
    ctx.beginPath();ctx.moveTo(p.x,headY+16);ctx.lineTo(p.x+p.facing*28,headY+28+armSwing);ctx.stroke();
    if(p.punch){ctx.beginPath();ctx.moveTo(p.x,headY+16);ctx.lineTo(p.x+p.facing*40,headY+28);ctx.stroke();}
    if(p.kick){ctx.beginPath();ctx.moveTo(p.x,p.y-18);ctx.lineTo(p.x+p.facing*35,p.y-10);ctx.stroke();}
    p.bubbles.forEach((b,i)=>{ctx.fillStyle='rgba(173,216,230,0.8)';ctx.beginPath();ctx.arc(p.x,p.y-p.height-10-i*12,6,0,2*Math.PI);ctx.fill();});
  });
}

// --- Loop ---
let running=true,last=0;
function loop(ts){const dt=(ts-last)/1000; last=ts; if(running){update(dt);draw();requestAnimationFrame(loop);}}
requestAnimationFrame(loop);

// --- Arena Buttons ---
document.getElementById('arenaGrasslands').onclick=()=>{currentArena='grasslands';setupArena('grasslands');document.getElementById('overlay').style.display='none';};
document.getElementById('arenaSahara').onclick=()=>{currentArena='sahara';setupArena('sahara');document.getElementById('overlay').style.display='none';};
document.getElementById('arenaRainyForest').onclick=()=>{currentArena='rainyforest';setupArena('rainyforest');document.getElementById('overlay').style.display='none';};
document.getElementById('arenaDryland').onclick=()=>{currentArena='dryland';setupArena('dryland');document.getElementById('overlay').style.display='none';};
setupArena('grasslands');
</script>
</body>
</html>
